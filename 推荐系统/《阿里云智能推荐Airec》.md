# 《阿里云智能推荐Airec》

## 购买指导

### 选型介绍

### 续费指南

### 弹性计费说明

### 价格说明

### 到期或欠费的影响

## 快速入门

### 服务接入步骤导览

### 准备工作

- 一、根据数据规范准备数据

	- 1. 测试数据下载地址

	- 2. 内容行业

		- 数据描述

			- 1. 内容表（item）：最近场景内全部可以被推荐的内容的全量表。

			  由于item数量受quota限制，建议您上传前做去重处理。
			  item_id与item_type二者同时唯一确定一条item。
			  

			- 2. 用户表（user）：最近系统的全部注册用户表。

			  由于user数量受quota限制，建议您上传前做去重处理。
			  根据您内部的用户标记方法，可以选择方案一均通过imei唯一确认一名用户，方案二通过user_id和imei组合确认一名用户（如登录用户使用user_id唯一 标记，未登录用户使用imei唯一标记）。
			  请务必确认用户的唯一性并在请求推荐结果时指定用户的唯一标识信息，否则将无法进行千人千面的推荐。
			  

			- 3. 行为表（behavior）：最近一段时间场景的行为数据。

			  我们建议您提供1-2周的数据。如果是全新场景，没有历史数据；或者因为技术原因无法提供行为数据，可以使用我们提供的测试数据，但是在开始一段时间（大约2周）内，模型的效果可能会不太理想，但随着数据的积累，会逐渐上升并最终稳定。对于这三张表的选填字段，我们建议您尽量上传。
			  在保证选填字段有效性的条件下，这些选填字段越多越准确，模型的效果越好。未填写部分系统内部将渲染成默认值。
			  

		- 表结构

			- item
			- user
			- behavior

		- behavior type
		- 建表语句
		- MaxCompute

- 二、核对行为埋点逻辑是否符合规范

	- 1. 数据埋点指南

		- 1. 使用业务场景

		  目前智能推荐的猜你喜欢，以新闻行业为例，适用于首页的feed流推荐，以优化用户的点击为主。
		  
		  目标为通过用户的浏览行为，引导用户点击阅读feed流中推荐的内容，并在浏览深度，停留时长等相关指标有一定的促进。
		  

		- 2. 训练数据

			- 1. 内容表

			  为需要向用户推荐的具体的内容，用户需要将所有需要推荐的内容，输入到内容表中。智能推荐通过模型训练，返回给每一个具体用户最合适的item内容。我们建议您提供有效内容的内容表，这样尽量避免无效数据而形成的噪音，这对推荐效果的提升，有显著的帮助。
			  

			- 2. 用户表

			  需要将阅读新闻的每一个用户相关信息，输入到用户表中，智能推荐会训练不同用户的喜好行为，为其推荐出最感兴趣的内容。
			  

			- 3. 行为表

			  需要将推荐相关的行为，输入到behavior表中，这部分内容是智能推荐训练模型的核心要素，脏数据会严重影响模型训练结果。
			  
			  用户进行了如上操作后，应该产生了4条推荐相关的行为：对3条item的曝光行为，对itemA的点击行为。需要将此4条行为分别记录，并按要求上传到智能推荐系统中。
			  
			  注：必须是推荐场景下的行为（eg：对于用户搜索出来的结果页的相关行为，不属于），否则会严重干扰模型
			  

			- 4. 埋点数据

				- 1. 曝光行为埋点

				  曝光对应的是行为（behavior）表的bhv_type字段，是上传用户行为的一种类型。一条数据展示给用户一次，就算做一条曝光行为。
				  

					- 1. 什么是曝光行为

					  曝光对应的是行为（behavior）表的bhv_type字段，是上传用户行为的一种类型。一条数据展示给用户一次，就算做一条曝光行为。
					  

					- 2. 如何埋点
					- 3. 埋点注意事项

					  一条数据定位曝光行为，需要满足以下3个要素
					  需要在客户端有展示透出的行为（也就是用户可以直观的看到）
					  需要有一定的停留时长（比如1s）
					  短时间内对同一个用户的反复曝光，不应累积，只算1次。
					  

						- 埋点反例

							- 1、对于用户在客户端首页的上下滑动，不应累积曝光。
							- 2、对于用户从feed流点击进入详情页，再返回feed流首页，也不应累积曝光。

				- 2. 点击行为埋点

					- 1. 什么是点击行为

					  点击行为相对比较好理解，只要用户对某一个item点击阅读详情，均算做一次点击。
					  

					- 2. 如何埋点
					- 3. 埋点注意事项

					  一条数据定位点击行为，需要满足以下3个要素
					  1、需要在客户端，用户产生有效的点击行为。
					  2、点击行为对点击后阅读时长不做限制。
					  3、短时间内同一用户的多次点击，不应累积，只算1次。
					  

				- 3. 场景ID埋点

					- 1. 什么是场景

					  场景对应的是内容（item）表和行为（behavior）表中scene_id字段，是指数据投放的不同场景，可以理解成是对数据的一个分类。用户如果只有一个场景需要投放，该字段可以不填（默认是1，页面测试查询的时候需要带上）。
					  

					- 2. 如何埋点

					  场景的埋点，内容（item）主要在服务器端对商品进行分类，行为（behavior）主要在客户端对指定投放场景的记录。
					  

					- 3. 埋点注意事项

					  场景ID只是用来区分item（内容）所投放到前端的产品场景，理论上只要能明确的区分不同场景即可，不体现场景的父子关系。如：体育频道下可能您会有最新比分、赛事预告、赛事点评等，针对这种情况，我们不建议使用场景ID区分，可以使用下文提到的类目进行划分。
					  

					- 4. 如何使用

					  在通过SDK查询推荐结果时，需要带上对应的scene_id，展示对应的场景下的结果。对于有些用户会有首页的推荐需求：
					  1、首页没有自己的item数据。
					  2、希望首页展示的是多个场景下聚合的item数据。
					  

				- 4. TAG埋点

					- 1. 什么是tag

					  TAG对应的是user表和item表中的tag字段，是指您对内容（item）提炼的特征的文本描述，多个tag之间直接以逗号分隔。
					  

					- 2. 如何埋点

					  TAG对应的是user表和item表中的tag字段，是指您对内容（item）提炼的特征的文本描述，多个tag之间直接以逗号分隔。
					  
					  如上图，可以对该item提炼出：SUV，丰田，汉兰达等相关tag，并以逗号分隔方式，传入item表中。
					  

				- 5. 类目层级埋点

					- 1. 什么是类目层级

					  类目层级对应的是内容（item）表中的category_path和category_level字段，主要作用是对相同主题和属性的内容（item）进行归类，在通过实例运营策略提升推荐结果多样性中的打散功能（见下文解释）中会使用到。
					  

					- 2. 如何埋点

					  类目层级的埋点主要在服务器端，对内容（item）进行归类
					  

					- 3. 如何使用

					  类目分类在用户配置混排打散功能时，会出现按类目比例返回查询结果的效果。例如：对上文数据，如果配置打散层级是2，那么该场景下查出来的推荐结果，itemA,itemB,itemC会在恒大，CBA，中超三类上混合展示。如果配置打散层级为1，那么推荐结果会是足球，篮球的混排结果。
					  

				- 6. 失效时间埋点

					- 1. 什么是失效时间

					  失效时间对应的是内容（item）表中的expire_time字段，用来定义本条数据的过期时间。当服务器的实际大于该值时，本条数据将强制不被推荐。
					  

					- 2. 如何埋点

					  失效时间的埋点主要在服务器端，按某一系统规则自动或者由人工设置。
					  

					- 3. 埋点注意事项

						- 1、如果本条内容（item）没有失效时间，则上传的对应字段置为空即可
						- 2、失效时间需要以时间戳方式提供，单位为秒（s）
						- 3、如果第一次上传的所有数据均过期，服务无法启动

				- 7. STATUS埋点

					- 1. 什么是status

						- status对应的是内容（item）表中的status字段，用来定义本条数据是否可推荐（0：不可推荐，1：可推荐）。

					- 2. 如何埋点

						- status的埋点主要在服务器端，按某一系统规则自动或者由人工设置。

					- 3. 埋点注意事项

						- 1、内容（item）表中的status字段为必填项，无法置为空。
						- 2、第一次上传数据时，如果全部内容（item）的status埋点数据为0，则服务无法启动。

		- 3. 相关概念

			- feed流：是一种给用户持续提供内容的数据形式。
			- 浏览深度：在一个计算周期内，每个访问次数给统计对象所带来的页面浏览量和均值。
			- 停留时长：用户在某一个页面停留的时间。
			- 打散：一次推荐查询中，返回的推荐结果包含多类目数据。

- 三、确认合适的数据上传方案

	- 快速启动实例
	- 通过历史数据启动实例
	- 模型启动

		- 1. 通过友盟+服务端SDK快速启动实例

			- 一、适配场景

			  已经对接友盟客户端SDK；
			  从未进行行为数据采集，需要0-1埋点；
			  当前埋点方案过于简单，数据维度过少。
			  

			- 二、流程图
			- 三、user、item、behavior数据的上传

				- I 存量数据

				  存量数据指的是当前的商品池、用户池、行为数据，是启动服务的初始数据。
				  user数据和item数据：通过官方文档中服务端SDK进行上传。
				  behavior数据：当绑定友盟后，会自动上报。
				  

				- II 增量数据

				  增量数据指的是这三种数据产生了增加的变化，并需要和存量数据合并的新增数据。
				  user数据和item数据：通过官方文档中服务端SDK进行上传。
				  behavior数据：当绑定友盟后，会自动上报。
				  

				- III 服务端SDK使用方法
				- IV 服务端SDK推送数据的表信息
				- V 推送数据官方文档例子

			- 四、具体操作

				- I 选择行业

				  注意：实例启动后，您选择的行业不支持变更。
				  

				- II 选择启动智能推荐服务的方式

				  由于我们选择的是友盟+服务端sdk，所以此处选择“快速启动”。注：快速启动是通过智能推荐提供的默认数据启动实例。实例启动后会自动删除这些数据。
				  

				- III 配置实时数据源

					- 1、选择通过友盟sdk上传行为数据（实时上传）

				- IV 配置离线存储

				  注意：
				  1.此处的项目名称建议使用独立的项目空间，避免和启动数据的项目空间一致。
				  2.配置离线存储数据源之前，需要在MaxCompute中给智能推荐授权可读及可写权限，详见查看离线数据配置。
				  3.离线存储项目建议不要修改及删除，且需保持不欠费，建议设置为自动续费。
				  4.实例启动成功后，可以在控制台-离线存储功能处，查看离线存储表的分区信息。
				  5.当前版本支持您在您的MaxCompute-cmd中管理离线数据。
				  支持所有MaxCompute中的操作，高危操作时请谨慎处理，MaxCompute具体操作详见：MaxCompute官档。
				  6.对于产出的所有离线数据不要进行高危操作（增加、删除、改写等），否则将会影响智能推荐服务对离线数据的计算。
				  

				- V 启动实例（一个半小时左右启动完成）
				- VI 通过服务端SDK上报数据

					- 注意：要先推送物品数据和用户数据，然后再推送行为数据。

			- 五、配置实例的服务类型（猜你喜欢、相关推荐）

				- I 点击创建场景
				- II 选择本场景的推荐服务类型
				- III 场景列表展示

		- 2. 通过历史数据启动实例

			- 一、适配场景

				- 已经开通MaxCompute服务，并能熟练使用其各项操作。

		- 3. 通过全服务端SDK快速启动实例

			- 一、适配场景

				- 已经具备丰富的埋点数据；
				- 未开通MaxCompute服务或不熟悉其操作 。

- 四、使用友盟SDK（可选）

### 数据规范

### 数据埋点指南

### 模型启动

## 操作指南

### 业务效果

​ 您可以在本功能中，查看相应指标，支持对站内用户进行指标分析，以及针对物品进行指标分析：
业务指标：
​PV_CTR：Click-Through-Rate）即点击通过率，计算公式：总点击数/总曝光数。（不去重）。
​UV_CTR：基于用户的点击率，计算公式：有点击用户/总浏览用户。
​PV_CVR（转化率）:购买次数/点击次数。
​UV_CVR(转化率) ：购买用户数/点击用户数。
​用户活跃度：
​ 日活用户数、月活跃用户数。
​整体流量规模：
​ 曝光、点击、收藏、评价、加购、购买。
​流量转化率：
​ 收藏率、评价率、加购率。
​人均流量：
​ 曝光次数、点击次数、行为总计。


### 调用测试

- 一、实时推荐接口体验测试
- 二、用户推荐历史查询分析

### 指标监控及报警的使用方法

## 数据源管理

### 测试数据下载地址

### 上传全量数据

### 创建数据源

### 全量数据管理概述

## 开发参考

### 推送数据及获取推荐结果

### 服务端SDK

### API参考

### 友盟SDK的使用

## 最佳实践

### 通过负反馈功能提升终端用户推荐精准度

- 背景

  在用户与推荐系统互动的过程中，有可能出现不符用户预期的推荐结果，有可能是多样性策略触达的不符预期、人生阶段变化导致的兴趣变动，也有可能是一些话题/图片使得用户感到不适。
  
  而负反馈功能即可提供一个推荐系统与终端用户互动的窗口，结合终端用户的负面兴趣反馈，从而提升推荐的在个人体感的个性化程度。
  

- 功能

	- 1、针对单个物品拉黑
	- 2、针对物品某种特征不喜欢
	- 3、针对与该物品相似相关物品的不喜欢

### 通过选投策略配置，快速搭建推荐场景

### 通过实例运营策略提升推荐结果多样性

### 新闻行业通过上下架设置、场景搭建保障推荐内容时效性

### 调整I2I算法策略，强化实时反馈的用户体验

### 调整物品特征优先级，适配行业特征优化效果

### 调整新品策略，高效扶持新品流量

### 通过推荐过滤功能实现Feed流个性化过滤

### 疲劳度（原曝光过滤）规则使用说明

## 常见问题

### 准备工作期

### 数据对接期

### 效果测试期及控制台中的问题

### 配额及友盟相关的问题

## demo测试

### 1. 配置并启动实例

### 2. 推送一个用户

- 1. 下载demo

- 2. 配置ak、sk、instanceId
- 3. 设置表名，构建用户数据

- 4. 获得推送结果
- 5. 查询推送用户

### 3. 推送一个物品

### 4. 推送一个行为

### 5. 获得推荐结果

- 1. 推送完后没法获得结果

### 阿里云智能推荐AIRec文档说明与SDK测试

## 埋点架构

### 1. 埋点功能

- 1. 首页直播推荐

*XMind - Trial Version*